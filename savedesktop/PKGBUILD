pkgname=savedesktop
_app_id=io.github.vikdevelop.SaveDesktop
pkgver=2.2.3
pkgrel=1
pkgdesc="Save and load KDE Plasma, Xfce and GNOME-based DE configuration"
arch=('any')
url="https://github.com/vikdevelop/SaveDesktop"
license=('GPL3')
depends=('hicolor-icon-theme' 'libadwaita' 'python-gobject')
checkdepends=('appstream-glib')
source=("$pkgname-$pkgver.tar.gz::$url/archive/refs/tags/$pkgver.tar.gz")
sha256sums=('916309ff46d51a85cf21fabacc58f91d1ce543960c2162676a41af30282d345b')

prepare() {
  cd "SaveDesktop-$pkgver"
  sed -i "s|Exec=run.sh|Exec=/usr/share/$pkgname/main_window.py|g" \
    "flatpak/$_app_id.desktop"
  sed -i "s|/app/translations/|/usr/share/$pkgname/translations/|g" \
    src/main_window.py
  sed -i 's|dialog.set_version("2.2.2")|dialog.set_version("2.2.3")|g' \
    src/main_window.py
}

check() {
  cd "SaveDesktop-$pkgver"
  appstream-util validate-relax --nonet "flatpak/$_app_id.metainfo.xml"
  desktop-file-validate "flatpak/$_app_id.desktop"
}

package() {
  cd "SaveDesktop-$pkgver"
  install -Dm755 src/main_window.py -t "$pkgdir/usr/share/$pkgname/"
  cp -R translations "$pkgdir/usr/share/$pkgname/"
  install -Dm644 "flatpak/$_app_id.desktop" -t "$pkgdir/usr/share/applications/"
  install -Dm644 "flatpak/icons/$_app_id.png" -t "$pkgdir/usr/share/pixmaps/"
  install -Dm644 flatpak/symbolic-icons/exclamation_mark.png -t \
    "$pkgdir/usr/share/icons/hicolor/symbolic/actions/"
  install -Dm644 "flatpak/$_app_id.metainfo.xml" -t "$pkgdir/usr/share/metainfo/"

  install -d "$pkgdir/usr/bin"
  ln -s "/usr/share/$pkgname/main_window.py" "$pkgdir/usr/bin/$pkgname"
}
